<!DOCTYPE html>
<html ng-app="myapp2">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/jquery-1.9.0.js"></script>
    <script src="js/angular.1.5.0.js"></script>
    <script src="js/angular.1.5.0beta.router.js"></script>
    <script src="js/jquery-weui.js"></script>
    <link rel="stylesheet" href="css/iconfont.css" />
    <link rel="stylesheet" href="css/weui.css" />
    <link rel="stylesheet" href="css/jquery-weui.css" />

    <style>
        body {
            background: rgb(245, 245, 245);
            color: rgb(48, 48, 48);
            font-family: "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", FreeSans, Arimo, "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", FontAwesome, sans-serif;
        }
        
        select {
            font-size: 16px;
        }
        /*头部*/
        
        .weui-search-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
        }
        /*中间内容*/
        
        .tab1_content,
        .tab2_content {
            padding-bottom: 200px;
            margin-top: 44px;
            line-height: 30px;
            position: relative;
        }
        
        .tab1_content .weui-flex {
            border-top: 1px solid rgb(213, 213, 213);
            border-bottom: 1px solid rgb(213, 213, 213);
        }
        
        .tab1_content .weui-flex__item {
            border-left: 1px solid rgb(213, 213, 213);
            text-align: center;
        }
        
        .tab1_content .weui-flex__item:nth-of-type(1) {
            border-left: none;
        }
        
        .tab1_content #select1 {
            border: none;
            outline: none;
            background: none;
        }
        
        .weui-media-box {
            padding: 0;
        }
        
        .tab1_content .weui-panel {
            margin: 0;
            border: 0px;
            border-bottom: 1px solid rgb(213, 213, 213);
        }
        
        .tab1_content .btn_cli,
        .tab2_content .btn_cli,
        .tab3_content .btn_cli {
            position: fixed;
            bottom: 63px;
            left: 5px;
            z-index: 999;
        }
        
        .tab1_content .weui-flex {
            background: white;
        }
        
        .tab2_content,
        .tab3_content {
            margin-top: 0;
            border: none;
            border-color: white;
            margin-bottom: 200px;
            padding-bottom: 0;
        }
        
        .tab2_content .weui-panel {
            margin-top: 0;
        }
        
        .tab2_content .tab_logo {
            border: 1px solid rgb(213, 213, 213);
        }
        
        .tab2_content .weui-navbar {
            position: static;
        }
        
        .tab2_content .weui-navbar {
            flex-wrap: wrap;
        }
        
        .tab2_content .weui-navbar__item {
            border: none;
            min-width: 60px;
            max-width: 60px;
            font-size: 12px;
        }
        
        .tab2_content .weui-navbar__item:after {
            display: none;
        }
        
        .tab2_content .weui-navbar__item {
            padding: 0;
        }
        
        .tab3_content .weui-cells {
            margin-top: 0;
        }
        
        .tab3_content .weui-cell {
            padding-top: 2px;
            padding-bottom: 2px;
            ;
        }
        
        .tab3_content .addmore {
            font-size: 12px;
            line-height: 30px;
            border-top: 1px solid #D9D9D9;
            text-align: center;
        }
        
        .tab3_content .addmore:before {
            content: "";
            display: block;
            height: 10px;
            width: 100%;
            background: rgb(245, 245, 245);
        }
        
        .tab3_content .weui-cells:before {
            border-top: none;
        }
        
        .tab3_content .btn_more {
            text-align: center;
            line-height: 30px;
            color: rgb(98, 98, 98);
        }
        /*底部*/
        
        .weui-tabbar {
            background: white;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 999;
        }
        
        .weui-tabbar__item.weui-bar__item--on .iconfont {
            color: darkorange;
        }
        
        .weui-tabbar__item.weui-bar__item--on .weui-tabbar__label {
            color: darkorange;
        }
        
        #ngview {
            position: fixed;
            top: 0;
            left: 0;
            background: white;
            width: 100%;
        }
        
        .tosearch {
            display: inline-block;
        }
    </style>
</head>

<body ng-controller="myctr2">
    <div id="app">
        <div class="weui-tab">
            <div class="weui-tab__bd">
                <!--第一个tab点击的内容-->
                <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
                    <div class="weui-search-bar" id="searchBar">
                        <form class="weui-search-bar__form">
                            <div class="weui-search-bar__box">
                                <i class="weui-icon-search"></i>
                                <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required="">
                                <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
                            </div>
                            <label class="weui-search-bar__label" id="searchText">
										<i class="weui-icon-search"></i>
										<span>搜索</span>
									</label>
                        </form>
                        <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
                    </div>
                    <div class="tab1_content">
                        <div class="weui-flex">
                            <div class="weui-flex__item">有几个客户</div>
                            <div class="weui-flex__item">
                                <select name="" id="select1">
											<option value="">
												全部客户
											</option>
											<option value="">
												全部客户
											</option>
										</select>
                            </div>
                            <div class="weui-flex__item">
                                <i class="iconfont icon-paixushengxu" style="font-size:25px;vertical-align: middle;"></i>
                            </div>
                        </div>
                        <div class="btn_cli">
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_primary">新建</a>
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_plain-default">查重</a>
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_warn">附近</a>
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_plain-primary">名片扫描</a>
                        </div>
                        <div class="weui-panel weui-panel_access">
                            <div class="weui-panel__hd">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd">
                                        <p>11111111111</p>
                                        <p>11111111111</p>
                                        <p>11111111111</p>
                                    </div>
                                    <div class="weui-media-box__hd">
                                        <i class="iconfont icon-weixin"></i>
                                        <i class="iconfont icon-dianhua"></i>
                                    </div>
                                </a>
                            </div>

                        </div>

                    </div>
                </div>

                <!--详情点击的tab-->
                <div id="tab2" class="weui-tab__bd-item">
                    <div class="tab2_content">
                        <div class="btn_cli">
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_primary">添加</a>
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_plain-default">编辑</a>
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_warn">转交</a>
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_plain-primary">更多</a>
                        </div>
                        <div class="weui-panel weui-panel_access">
                            <div class="weui-panel__hd">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__hd">
                                        <!--<img class="weui-media-box__thumb" src="">-->
                                        <p class="tab_logo">初访</p>
                                    </div>
                                    <div class="weui-media-box__bd">
                                        <p>上海浦发银行张江支行</p>
                                        <p>地址：<span>科苑路399号</span></p>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="weui-navbar">
                            <div class="weui-navbar__item weui_bar__item_on">
                                选项一
                            </div>
                            <div class="weui-navbar__item">
                                选项二
                            </div>
                            <div class="weui-navbar__item">
                                选项三
                            </div>
                            <div class="weui-navbar__item">
                                选项二
                            </div>

                        </div>
                        <div class="detail">
                            <div class="weui-panel weui-panel_access">
                                <div class="weui-panel__hd">
                                    <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                        <div class="weui-media-box__bd">
                                            <p>2018.3.25 星期三</p>
                                            <p><i class="iconfont icon-dianhua"></i>来电话</p>
                                            <p>有意向使用</p>
                                        </div>
                                        <div class="weui-media-box__hd">
                                            <p>刘柳</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--添加点击的tab-->
                <div id="tab3" class="weui-tab__bd-item">
                    <div class="tab3_content">
                        <div class="btn_cli">
                            <a href="javascript:;" class="weui-btn_mini weui-btn weui-btn_primary">保存</a>
                        </div>
                        <div class="weui-cells weui-cells_form">
                            <div class="weui-cells__title">客户名称</div>
                            <div class="weui-cells">
                                <div class="weui-cell weui-cell_access">
                                    <div class="weui-cell__bd">
                                        <!-- 这里模拟的当select数据量大的时候用下面的方式跳到搜索页找数据 -->
                                        <a class="weui-input tosearch" href="#/search.html">{{clientName}}</a>
                                        <input class="weui-input" type="text" style="display: none;" ng-model="clientName">
                                    </div>
                                    <div class="weui-cell__ft"></div>
                                </div>
                            </div>
                            <div class="weui-cells__title">客户级别</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入客户级别">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cells__title">联系人</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入联系人">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cells__title">电话</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入联系人">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cells__title">地址</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入地址">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cells__title">邮箱</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入邮箱">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cells__title">微信</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入微信">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cells__title">联系人</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__bd">
                                        <input class="weui-input" type="text" placeholder="请输入联系人">
                                    </div>
                                </div>
                            </div>
                            <div class="cli_more">
                                <div class="weui-cells__title">更多1</div>
                                <div class="weui-cells">
                                    <div class="weui-cell">
                                        <div class="weui-cell__bd">
                                            <input class="weui-input" type="text" placeholder="请输入联系人">
                                        </div>
                                    </div>
                                </div>
                                <div class="weui-cells__title">更多2</div>
                                <div class="weui-cells">
                                    <div class="weui-cell">
                                        <div class="weui-cell__bd">
                                            <input class="weui-input" type="text" placeholder="请输入联系人">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="btn_more">
                                展开更多
                            </div>



                            <div class="addmore"> <i class="iconfont icon-jia"></i>添加其他联系人</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="weui-tabbar" style="position:fixed;bottom:0;left:0;z-index:999;">
                <a href="1.index.html" class="weui-tabbar__item">
                    <!--<span class="weui-badge" style="position: absolute;top: -.4em;right: 1em;">8</span>-->
                    <div class="weui-tabbar__icon">
                        <i class="iconfont icon-shouye"></i>
                    </div>
                    <p class="weui-tabbar__label">首页</p>
                </a>
                <a href="#tab1" class="weui-tabbar__item weui-bar__item--on">
                    <!--<span class="weui-badge" style="position: absolute;top: -.4em;right: 1em;">8</span>-->
                    <div class="weui-tabbar__icon">
                        <i class="iconfont icon-kehu "></i>
                    </div>
                    <p class="weui-tabbar__label">客户</p>
                </a>
                <a href="#tab2" class="weui-tabbar__item">
                    <div class="weui-tabbar__icon">
                        <i class="iconfont icon-chanpin"></i>
                    </div>
                    <p class="weui-tabbar__label">详情</p>
                </a>
                <a href="#tab3" class="weui-tabbar__item">
                    <div class="weui-tabbar__icon">
                        <i class="iconfont icon-qdao"></i>
                    </div>
                    <p class="weui-tabbar__label">添加</p>
                </a>
            </div>
        </div>
        <div id="ngview" ng-view></div>
    </div>

    <script>
        var app = angular.module("myapp2", ["ngRoute"]);

        app.controller("myctr2", function($scope) {
            $scope.clientName = "请输入客户名称";
            $scope.$on('changeclientName', function(event, data) {
                $scope.clientName = data;
            });

        });
        app.controller("myctr3", function($scope) { //搜索页面的controller;
            $scope.detail = ["客户1", "客户2", "客户3", "客户4", "客户5"];
            $scope.show = $scope.detail;
            $scope.search = "";
            $scope.$watch('search', function(ne, ol, scope) { //搜索的功能
                var arr = [];
                var detail = scope.detail;
                angular.forEach(detail, element => {
                    if (element.indexOf(ne) > -1) {
                        arr.push(element);
                    }
                });
                scope.show = arr;
            });

            $scope.pickName = function(e) {
                var ev = e || event ? event : window.event;
                var el = ev.target;
                var inner = el.innerText;
                $scope.$emit('changeclientName', inner);
                window.history.go(-1);
            };
        });


        //如果要从后台获取数据，按着页数来就用这个controller,把上面的myctr3这个controller注释掉用这个没有做测试还；
        /*// 定义滚动指令  
        app.directive('whenScrolled', function() {
            return function(scope, elm, attr) {
                // 内层DIV的滚动加载  
                var raw = elm[0];
                elm.bind('scroll', function() {
                    if (raw.scrollTop + raw.offsetHeight >= raw.scrollHeight) {
                        scope.$apply(attr.whenScrolled);
                    }
                });
            };
        });
        app.controller('myctr3', ['$scope', '$http',
            function($scope, $http) {
                // 当前页数  
                $scope.currentPage = 0;
                // 总页数  
                $scope.totalPages = 1;
                // 防止重复加载  
                $scope.busy = false;
                // 存放数据  
                $scope.items = [];
                $scope.show = $scope.items;
                $scope.$watch('search', function(ne, ol, scope) { //搜索的功能
                    var arr = [];
                    var items = scope.items;
                    angular.forEach(items, element => {
                        if (element.indexOf(ne) > -1) {
                            arr.push(element);
                        }
                    });
                    scope.show = arr;
                });

                $scope.pickName = function(e) {
                    var ev = e || event ? event : window.event;
                    var el = ev.target;
                    var inner = el.innerText;
                    $scope.$emit('changeclientName', inner);
                    window.history.go(-1);
                };
                // 请求数据方法  
                $scope.loadMore = function() {
                    if ($scope.currentPage < $scope.totalPages) {
                        $scope.currentPage++;
                        if ($scope.busy) {
                            return false;
                        }
                        $scope.busy = true;
                        // 请求后台服务器  
                        $http.get('http://127.0.0.1/Test/scroll/Test.php?page=' + $scope.currentPage)
                            .success(function(data) {
                                $scope.busy = false;
                                //组织数据  
                                for (var i in data.data) {
                                    $scope.items.push(data.data[i]);
                                }
                                $scope.totalPages = data.countPage;
                            });
                    }
                };
                // 默认第一次加载数据  
                $scope.loadMore();
            }
        ]);

*/ //服务器获取数据结束





        /*路由*/
        app.config([
            "$routeProvider",
            function($routeProvider) {
                $routeProvider
                    .when("/search.html", {
                        templateUrl: "search.html",
                        controller: "myctr3"
                    })
            }
        ]);


        function changetab() {
            var tab = window.location.hash;
            tab = tab.substr(2);
            var num = tab.substr(-1, 1);
            if (tab) {
                $(".weui-tab__bd-item").removeClass("weui-tab__bd-item--active");
                $(".weui-tabbar>a").removeClass("weui-bar__item--on");
                $("#" + tab).addClass("weui-tab__bd-item--active");
                $(".weui-tabbar>a").eq(num).addClass("weui-bar__item--on")
            }
        };
        changetab();
        $(function() {
            var cli_flag = true;
            $(".tab3_content .cli_more").slideUp();
            $(".tab3_content .btn_more").on("click", function() {
                if (cli_flag) {
                    $(".tab3_content .cli_more").slideDown();
                    cli_flag = false;
                } else {
                    $(".tab3_content .cli_more").slideUp();
                    cli_flag = true;
                };

            });

        })
    </script>
</body>

</html>