webpackJsonp([4],{CqvV:function(t,s){},gWrr:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=e("Dd8w"),a=e.n(o),i=e("G3Cf"),n=e("NYxO"),l=e("SC/i"),r={data:function(){return{showLoading:!0,pullUpLoad:!1,appendToBody:!0,items:[],showClose:!1,dialogVisible:!1,myfiles:[],SuggestForm:{IsAnonymous:"1",SuggestMsg:"",foodImg:""},SuggestRules:{SuggestMsg:[{validator:function(t,s,e){if(!s)return e(new Error("不能为空"));e()},trigger:"blur"}]},fileList:[],show:{type:Boolean,default:!1}}},created:function(){var t=this;this.$emit("changtab","2"),this.init(),setTimeout(function(){t.show=!0},20)},methods:{onPullingDown:function(){var t=this;setTimeout(function(){t.init()},1e3)},init:function(){var t=this;this.$axios.get("api/Suggest/GetSuggestAll?CanteenToken="+this.userToken).then(function(s){console.log(s),1===s.data.Code&&(t.items=s.data.Data,t.showLoading=!1)}).catch(function(s){s.response.data.Message.match("Token")||t.$alert("请求出错！！",{customClass:"myConfirm"})})},submitFormRate:function(t){var s=this;this.$refs[t].validate(function(e){if(!e)return s.$refs[t].resetFields(),console.log("error submit!!"),!1;var o="1"===s.SuggestForm.IsAnonymous;if(o=!!o,!s.myfiles)return s.$alert("请上传图片",{customClass:"myConfirm"}),!1;for(var a=new FormData,i=0;i<s.myfiles.length;i++)a.append("file",s.myfiles[i].raw);s.$axios.post("api/Suggest/Add?CanteenToken="+s.userToken+"&SuggestMsg="+s.SuggestForm.SuggestMsg+"&IsAnonymous="+o+"&isformdata=0",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){1===t.data.Code?(s.$message({message:"成功",type:"success"}),s.init()):s.$message({message:"失败："+t.data.Message,type:"error"}),s.dialogVisible=!1}).catch(function(e){s.$refs[t].resetFields(),s.$message({message:"失败："+e.response.data.Message,type:"error"})})})},showDialog:function(){this.dialogVisible=!0},handleRemove:function(t,s){var e=this;this.myfiles.findIndex(function(s,o){return s===t&&(e.myfiles.splice(o,1),console.log(e.myfiles)),s===t})},handleExceed:function(t,s){this.$alert("最多只能上传两张，请重新选择！！",{customClass:"myConfirm"})},handleChange:function(t,s){this.myfiles.push(t)},showImg:function(t){this.$alert('<div style="text-align:center;"><img style="width:90%;" src="'+t+'" /></div>',{dangerouslyUseHTMLString:!0,customClass:"myConfirm"})}},components:{pull:i.default,Loading:l.a},computed:a()({},Object(n.c)(["userToken"]))},u={render:function(){var t=this,s=t.$createElement,o=t._self._c||s;return o("transition",{attrs:{name:"leftIn"}},[t.show?o("div",{staticClass:"suggest"},[o("div",{staticClass:"top"},[o("div",{staticClass:"inner"},[o("p",[t._v("吐槽建议")]),t._v(" "),o("p",{staticClass:"line"},[o("span",{staticClass:"left"}),t._v(" "),o("i",{staticClass:"dot"}),t._v(" "),o("span",{staticClass:"right"})]),t._v(" "),o("p",{staticClass:"tip"},[t._v("健康饮食")])])]),t._v(" "),o("div",{staticClass:"content"},[t.showLoading?o("loading",{staticClass:"loading"}):t._e(),t._v(" "),o("pull",{staticClass:"pull",attrs:{pullUpLoad:t.pullUpLoad,items:t.items},on:{onPullingDown:t.onPullingDown}},[o("ul",t._l(t.items,function(s,a){return o("li",{key:a},[o("div",{staticClass:"left"},[o("img",{attrs:{src:e("tUpq"),alt:""}})]),t._v(" "),o("div",{staticClass:"right"},[o("p",{staticClass:"user"},[t._v(t._s(s.UserName))]),t._v(" "),o("p",[t._v(t._s(s.SuggestMsg))]),t._v(" "),o("div",{staticClass:"foodImg"},t._l(s.Images,function(s,e){return o("img",{key:e,attrs:{src:s,alt:""},on:{click:function(e){t.showImg(s)}}})}),0),t._v(" "),o("div",{staticClass:"desc"},[o("div",{staticClass:"fl"}),t._v(" "),o("div",{staticClass:"fr"},[o("div",[t._v("2018.10.29")])])])])])}),0)]),t._v(" "),o("div",[o("el-button",{staticClass:"btnsub",attrs:{type:"primary"},on:{click:t.showDialog}},[t._v("提交建议")])],1)],1),t._v(" "),o("el-dialog",{staticStyle:{"text-align":"center"},attrs:{title:"填写建议","append-to-body":t.appendToBody,"show-close":t.showClose,visible:t.dialogVisible},on:{"update:visible":function(s){t.dialogVisible=s}}},[o("el-form",{ref:"rateForm",staticClass:"demo-ruleForm formSuggest",attrs:{"status-icon":"",rules:t.SuggestRules,model:t.SuggestForm,"label-width":"70px"}},[o("el-form-item",{attrs:{prop:"IsAnonymous",label:"是否匿名"}},[[o("el-radio",{attrs:{label:"1"},model:{value:t.SuggestForm.IsAnonymous,callback:function(s){t.$set(t.SuggestForm,"IsAnonymous",s)},expression:"SuggestForm.IsAnonymous"}},[t._v("是")]),t._v(" "),o("el-radio",{attrs:{label:"2"},model:{value:t.SuggestForm.IsAnonymous,callback:function(s){t.$set(t.SuggestForm,"IsAnonymous",s)},expression:"SuggestForm.IsAnonymous"}},[t._v("否")])]],2),t._v(" "),o("el-form-item",{attrs:{prop:"SuggestMsg",label:"建议内容"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请填写建议内容",rows:"5"},model:{value:t.SuggestForm.SuggestMsg,callback:function(s){t.$set(t.SuggestForm,"SuggestMsg",s)},expression:"SuggestForm.SuggestMsg"}})],1),t._v(" "),o("el-form-item",{staticStyle:{"margin-bottom":"5px"},attrs:{prop:"foodImg",label:"上传图片"}},[o("el-upload",{ref:"myfile",staticClass:"upload-demo",attrs:{name:"myfile",action:"","auto-upload":!1,"on-remove":t.handleRemove,"on-change":t.handleChange,multiple:"",limit:2,"on-exceed":t.handleExceed,"file-list":t.fileList},model:{value:t.SuggestForm.foodImg,callback:function(s){t.$set(t.SuggestForm,"foodImg",s)},expression:"SuggestForm.foodImg"}},[o("el-button",{attrs:{size:"small",type:"primary",plain:""}},[t._v("点击上传")])],1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer text-center",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:function(s){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(s){t.submitFormRate("rateForm")}}},[t._v("确 定")])],1)],1)],1):t._e()])},staticRenderFns:[]};var g=e("VU/8")(r,u,!1,function(t){e("CqvV")},"data-v-4ff2f8e2",null);s.default=g.exports},tUpq:function(t,s,e){t.exports=e.p+"img/bg12.175ce1d.jpg"}});